"use strict";(function(n){n.Oak=function(e,t){var u={fn:{buildInfoBox:function(e,t){var n=document.createElement("div");n.classList.add("infoBox");u.fn.buildInfoBoxLine(n,"Submitter: ",t.source.user.username,false);u.fn.buildInfoBoxLine(n,"Map: ",t.map.title,false);u.fn.buildInfoBoxLine(n,"Submitted: ",new Date(t.source.submission.date).toString(),false);u.fn.buildInfoBoxLine(n,"Play time: ",t.map.details.playTime.ticks?t.map.details.playTime.hours+"h "+t.map.details.playTime.minutes+"m "+t.map.details.playTime.seconds+"s":null,true);u.fn.buildInfoBoxLine(n,"Seed: ",t.map.details.gen.seed,true);u.fn.buildInfoBoxLine(n,"Map exch.: ",u.fn.buildInfoMapExchangeString(t.map.details.gen.exchangeString),true);u.fn.buildInfoBoxLine(n,"Mods: ",u.fn.buildInfoModList(t.map.details.mods),true);u.fn.buildInfoBoxLine(n,"Contributors: ",u.fn.buildInfoContribList(t.map.contributors),true);n.addEventListener("click",function(){if(n.classList.contains("opened")){n.classList.remove("opened")}else{n.classList.add("opened")}});u.fn.injectInto(n,[u.fn.injectInto(document.createElement("div"),[u.fn.injectInto(document.createElement("span"),["Click for more info"]),u.fn.injectInto(document.createElement("label"),["Click for less info"])])]);e.appendChild(n)},buildInfoBoxLine:function(e,t,n,a){if(null===n){return null}var i=document.createElement("div");if(a){i.classList.add("extended")}return u.fn.injectInto(e,[u.fn.injectInto(i,[u.fn.injectInto(document.createElement("label"),[t]),u.fn.injectInto(document.createElement("span"),[n])])])},buildInfoContribList:function(e){if(e.length===0){return null}var t=document.createElement("ul");for(var n in e){if(e.hasOwnProperty(n)){u.fn.injectInto(t,[u.fn.injectInto(document.createElement("li"),[e[n].username])])}}return t},buildInfoMapExchangeString:function(e){if(!e){return null}var t=document.createElement("textarea");t.value=e;t.addEventListener("click",function(e){e.preventDefault();e.stopPropagation();return false});var n=document.createElement("a");n.classList.add("mapex-display");n.addEventListener("click",function(e){n.parentElement.parentElement.classList.add("mapex");e.preventDefault();e.stopPropagation();return false});return u.fn.injectInto(document.createElement("div"),[u.fn.injectInto(n,["Display"]),u.fn.injectInto(document.createElement("span"),["Map exchange string, copy before creating a game",document.createElement("br")," to have the same map settings as this map:",document.createElement("br"),t])])},buildInfoModList:function(e){if(!e||e.length===0){return null}var t=document.createElement("ul");for(var n in e){if(e.hasOwnProperty(n)){u.fn.injectInto(t,[u.fn.injectInto(document.createElement("li"),[u.fn.injectInto(document.createElement("label"),[e[n].name]),u.fn.injectInto(document.createElement("span"),[e[n].version])])])}}return t},buildMap:function(e){var t=L.map("map",{layers:e.firstLayer,fadeAnimation:true,zoomAnimation:true}).setView([0,0],e.startZoom);if(e.countLayers===2&&false){u.fn.prepareLayerSlider()}else{if(e.countLayers>1){L.control.layers(e.layers,{},{collapsed:e.meta.meta.map.options.collapseLayerList}).addTo(t).setPosition("bottomright")}}new L.Hash(t,e.layers);t.addControl((new L.Control.Fullscreen).setPosition("bottomright"));t.zoomControl.setPosition("bottomleft");for(var n in e.markers){e.markers.hasOwnProperty(n)&&e.markers[n].addTo(t)}},buildMarker:function(e){return L.marker(e.coords,{title:e.title}).bindPopup(u.fn.buildMarkerPopup(e))},buildMarkerPopup:function(e){var t=document.createElement("div");t.innerHTML=e.text;return u.fn.injectInto(document.createElement("div"),[u.fn.injectInto(document.createElement("h3"),[e.title]),t])},buildMarkers:function(e,t){if(t&&Array.isArray(t)){for(var n=0;n<t.length;++n){e.markers.push(u.fn.buildMarker(t[n]))}}},buildSaveButton:function(e,r,t){if(t>0){var n=document.createElement("a"),l=document.getElementById("modal"),s=document.getElementById("save-download-container"),a=l.getElementsByClassName("close")[0],d=false,c=false;n.id="downBtn";n.appendChild(document.createTextNode("Download Save"));if(r.length===1){n.href=r[0].url;n.target="_blank"}else{n.addEventListener("click",function(){if(!d){if(!c){while(s.lastChild){s.removeChild(s.lastChild)}for(var e in r){if(r.hasOwnProperty(e)){var t=r[e];var n=document.createElement("li"),a=document.createElement("a"),i=document.createElement("span"),o=document.createElement("hr");o.classList.add("clear");a.classList.add("mapLayerLink");n.classList.add("mapLayer");u.fn.injectInto(a,["Download"]);a.target="_blank";if(!t.url){a.setAttribute("disabled","disabled");a.classList.add("disabled")}else{a.href=t.url}i.classList.add("mapLayerName");u.fn.injectInto(s,[u.fn.injectInto(n,[u.fn.injectInto(i,[t.layer]),a,o])])}}l.classList.add("open");d=true}}});a.addEventListener("click",function(){if(d){l.classList.remove("open");d=false}})}e.appendChild(n)}},findLayers:function(e,t){var n;for(var a=0;a<t.length;++a){n=t[a];var i=e.startZoom=Math.max(n.zoom.min-2,1);if(n.tiles.size===512){++e.startZoom}var o=n.tiles.url;if(location.host!==""){o="https://factoriomaps.com/"+m.meta.map.path+"/"+o}++e.countLayers;e.layers[n.name]=L.tileLayer(o,{id:n.name,attribution:'<a href="https://mods.factorio.com/mods/credomane/FactorioMaps">FactorioMaps</a>',minNativeZoom:n.zoom.min,maxNativeZoom:n.zoom.max,minZoom:i,maxZoom:n.zoom.max,noWrap:true,tileSize:n.tiles.size,keepBuffer:3});if(!e.firstLayer){e.firstLayer=e.layers[n.name]}if(n.save.download!==null&&n.save.download!==""){e.saves.push({layer:n.save.name||n.name,url:n.save.url});if(n.save.url){e.availableSaves++}}}},getFirstElement:function(e){return e&&Array.isArray(e)&&e.length?e.slice(0,1)[0]:null},init:function(t,e){u.fn.findLayers(t,t.meta.meta.map.layers);if(!t.availableSaves&&t.meta.links.save){t.saves.push({title:"Map download",url:t.meta.links.save});++t.availableSaves}u.fn.buildSaveButton(document.getElementById("buttonAnchor"),t.saves,t.availableSaves);if(!e){u.fn.buildMarkers(t,t.meta.meta.map.markers)}else{if(n.Cedar){t.cedar=n.Cedar.EditMap(map);if(m.meta.map.markers){t.cedar.ImportData(m.meta.map.markers)}document.getElementById("Cedar").addEventListener("click",function(){var e=document.location.href.split("#")[0].replace(/[^A-Z0-9a-z]/g,"-")+".json";n.saveAs(new Blob(["//#-# Source URL: "+document.location.href+"\n",JSON.stringify(t.cedar.ExportData()).replace("\\","\\\\")],{type:"application/octet-stream;charset=utf8",endings:"native"}),e,false)})}else{n.console.error("Map edit : Cedar module is not loaded.")}}u.fn.buildMap(t);u.fn.buildInfoBox(document.getElementById("buttonAnchor"),t.meta.meta)},injectInto:function(e,t){for(var n in t){if(t.hasOwnProperty(n)){if(t[n]instanceof Element){e.appendChild(t[n])}else{e.appendChild(document.createTextNode(t[n]))}}}return e}}};u.fn.init({layers:{},countLayers:0,firstLayer:null,markers:[],map:null,cedar:null,startZoom:1,saves:[],availableSaves:0,meta:e},undefined===t?false:t)}})(window);
