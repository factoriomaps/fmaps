"use strict";(function(l,y,t,b,a){if(l.Browse){return}var g={monthMap:["Jan.","Feb.","Mar.","Apr.","May","Jun.","Jul.","Aug.","Sep.","Nov.","Dec."],counter:0,fn:{applyFilter:function(e){g.fn.setHistory(e);e.isotope.arrange({filter:g.fn.buildFilterFunction(e),sortBy:"initial",sortAscending:{initial:false}})},buildBrowse:function(e,t,a){g.fn.purgeElement(e.container);e.buttons=y.createElement("div");e.buttons.classList.add("isotope-filter-container");e.itemContainer=y.createElement("div");e.itemContainer.classList.add("isotope-item-container");e.itemContainer.classList.add("row");g.fn.injectInto(e.container,[e.buttons,e.itemContainer]);for(var i in t){if(t.hasOwnProperty(i)){g.fn.injectInto(e.itemContainer,[g.fn.buildBrowseBox(e,t[i])])}}g.fn.parseUrl(e,a);g.fn.initHistory(e);g.fn.initIsotope(e);g.fn.buildFilter(e);g.fn.applyFilter(e)},buildBrowseBox:function(e,t){var a=y.createElement("div"),i=y.createElement("div"),r=y.createElement("div"),n=y.createElement("a"),s=y.createElement("img"),l=y.createElement("span"),o=y.createElement("span"),c=y.createElement("sup"),u=y.createElement("span"),f=y.createElement("hr"),p=new Date(t.date),d="",m=t.options;a.classList.add("Container-item");i.classList.add("header");r.classList.add("footer");l.classList.add("user");o.classList.add("date");u.classList.add("title");f.classList.add("clear");g.fn.injectInto(l,[t.username||"Anonymous"]);if(t.options.isPublicServer){a.classList.add("public-server")}if(t.options.isAnonymous){a.classList.add("anonymous");m.username="anonymous"}else{m.username=t.username;if(e.authorList.filter(function(e){return e===m.username}).length===0){e.authorList.push(m.username)}}if(t.playTime){m.playTime=t.playTime.hours*60*60+t.playTime.minutes*60+t.playTime.seconds;if(m.playTime>e.maxPlayTime){e.maxPlayTime=m.playTime}}else{m.playTime=0}m.date=p;d=g.fn.getDateSuffix(p);g.fn.injectInto(c,[d]);g.fn.injectInto(o,[g.monthMap[p.getMonth()]," ",p.getDate(),c," ",p.getFullYear()]);g.fn.injectInto(u,[m.title=t.worldName||"No world title"]);s.src=e.mapPreviewPrefix+t.mapPreviewUrl;n.href=t.url;g.fn.injectInto(i,[l,o,f]);g.fn.injectInto(r,[u]);g.fn.injectInto(n,[s]);g.fn.injectInto(a,[i,r,n]);m.topMap=(t.search.tags||[]).filter(function(e){return e==="featured"}).length>0;if(m.topMap){a.classList.add("featured")}m.tags=t.search.tags||[];m.tags.push(m.title);m.tags.push(m.username);e.isotopeData[++g.counter]=m;a.setAttribute("data-id",g.counter);a.setAttribute("data-date",t.date);a.setAttribute("data-order",(m.topMap?"1_":"0_")+t.date);return a},buildFilter:function(a){var e=y.createElement("select"),t=y.createElement("label"),i=y.createElement("div"),r=y.createElement("option"),n=y.createElement("input"),s=y.createElement("label"),l=y.createElement("div"),o=y.createElement("div"),c=y.createElement("label"),u=y.createElement("div"),f=y.createElement("input"),p=y.createElement("label"),d=y.createElement("div"),m=y.createElement("hr");a.authorList.sort(function(e,t){return e.toLocaleLowerCase()>t.toLocaleLowerCase()?1:-1});r.value="";g.fn.injectInto(r,[" - Select an author to filter - "]);g.fn.injectInto(e,[r]);for(var h in a.authorList){if(a.authorList.hasOwnProperty(h)){var v=y.createElement("option");g.fn.injectInto(v,[a.authorList[h]]);if(a.filters.author&&a.filters.author.value===a.authorList[h]){v.selected=true}g.fn.injectInto(e,[v])}}e.addEventListener("change",function(e){a.filters.author=null;var t=this.options[this.options.selectedIndex]?this.options[this.options.selectedIndex].value:null;if(t){a.filters.author={type:"equal",value:t,prop:"username"}}g.fn.applyFilter(a)});e.id=t.htmlFor="iso-filter-author";g.fn.injectInto(t,["Author : "]);i.classList.add("iso-filter-select-container");g.fn.injectInto(i,[t,e]);n.type="checkbox";n.id=s.htmlFor="iso-filter-cb-public";g.fn.injectInto(s,["Public servers : "]);if(a.filters.isPublicServer){n.indeterminate=false;n.checked=a.filters.isPublicServer.value;n.setAttribute("state",n.checked?"checked":"unchecked")}else{n.indeterminate=true;n.checked=false;n.setAttribute("state","none")}n.addEventListener("click",g.fn.triStateCheckboxClick.bind(n,a,"isPublicServer"));l.classList.add("iso-filter-public-container");g.fn.injectInto(l,[s,n]);o.id=c.htmlFor="iso-filter-playtime";b.create(o,{start:[a.filters.playTimemin?a.filters.playTimemin.value:0,a.filters.playTimemax?a.filters.playTimemax.value:a.maxPlayTime+1],tooltips:[true,true],step:1,margin:1,range:{min:0,max:a.maxPlayTime+1},format:{to:function(e){var t=Math.floor(e/(60*60)),a=Math.floor((e-t*60*60)/60),i=Math.floor(e-(t*60*60+a*60));return""+t+"h "+a+"m "+i+"s"},from:function(e){return e}}});o.noUiSlider.on("change",g.fn.noUiSliderChange.bind(o.noUiSlider,a,"playTime"));g.fn.injectInto(c,["Play time : "]);u.classList.add("iso-filter-playtime-container");g.fn.injectInto(u,[c,o]);if(a.filters.tags){f.value=a.filters.tags.value}p.htmlFor=f.id="iso-filter-searchbox";f.addEventListener("keyup",g.fn.inputSearchChange.bind(f,a,"tags"));g.fn.injectInto(p,["Search : "]);d.classList.add("iso-filter-search-container");g.fn.injectInto(d,[p,f]);m.classList.add("clear");m.classList.add("invisible");g.fn.injectInto(a.buttons,[i,l,d,u,m])},buildFilterFunction:function(n){return function(e){var t=n.isotopeData[parseInt(e.getAttribute("data-id"))];for(var a in n.filters){if(n.filters.hasOwnProperty(a)){var i=n.filters[a];if(i.type&&i.value!==undefined){var r=t[i.prop];if(!(r!==undefined)){return false}if(!Array.isArray(r)){r=[r]}if(r.filter(function(e){switch(i.type){case"equal":if(e!==i.value){return false}break;case"search":if(e.toLocaleLowerCase().indexOf(i.value.toLocaleLowerCase())===-1){return false}break;case">":if(e<=i.value){return false}break;case">=":if(e<i.value){return false}break;case"<":if(e>=i.value){return false}break;case"<=":if(e>i.value){return false}break}return true}).length<1){return false}}}}return true}},generateUrl:function(e){var t="";if(e.filters.author){t+="&user="+l.encodeURIComponent(e.filters.author.value)}if(e.filters.tags){t+="&search="+l.encodeURIComponent(e.filters.tags.value)}if(e.filters.isPublicServer){t+="&public="+l.encodeURIComponent(e.filters.isPublicServer.value?"true":"false")}if(e.filters.playTimemin){t+="&playStart="+l.encodeURIComponent(e.filters.playTimemin.value)}if(e.filters.playTimemax){t+="&playEnd="+l.encodeURIComponent(e.filters.playTimemax.value)}return l.location.pathname+t.replace("&","?")},getDateSuffix:function(e){var t="";switch(e.getDate()){case 1:case 11:case 21:case 31:t="st";break;case 2:case 22:t="nd";break;case 3:case 32:t="rd";break;default:t="th"}return t},initHistory:function(e){},initIsotope:function(e){e.isotope=new t(e.itemContainer,{getSortData:{initial:"[data-order]",date:"[data-date]"}})},injectInto:function(e,t){for(var a in t){if(t.hasOwnProperty(a)){if(t[a]instanceof Element){e.appendChild(t[a])}else{e.appendChild(y.createTextNode(t[a]))}}}},inputSearchChange:function(e,t){if(this.value){e.filters[t]={type:"search",value:this.value,prop:t}}else{delete e.filters[t]}g.fn.applyFilter(e)},noUiSliderChange:function(e,t,a,i,r){e.filters[t+"min"]={type:">=",value:parseInt(r[0]),prop:t};e.filters[t+"max"]={type:"<=",value:parseInt(r[1]),prop:t};g.fn.applyFilter(e)},parseUrl:function(e,t){var a=t.replace("?","").split("&");if(a.length>0){e.filters={};for(var i in a){if(a.hasOwnProperty(i)){var r=a[i].split("=");if(!(r[1]===undefined)){var n=l.decodeURIComponent(r[1]);switch(r[0]){case"user":e.filters.author={type:"equal",value:n,prop:"username"};break;case"search":e.filters.tags={type:"search",value:n,prop:"tags"};break;case"public":e.filters.isPublicServer={type:"equal",value:n==="true",prop:"isPublicServer"};break;case"playStart":e.filters.playTimemin={type:">=",value:n,prop:"playTime"};break;case"playEnd":e.filters.playTimemax={type:"<=",value:n,prop:"playTime"};break}}}}}},purgeElement:function(e){while(e.lastChild){e.removeChild(e.lastChild)}},setHistory:function(e){if(a){a.replaceState(e.filters,"",g.fn.generateUrl(e))}},triStateCheckboxClick:function(e,t,a){switch(this.getAttribute("state")){case"none":this.checked=true;this.indeterminate=false;this.setAttribute("state","checked");e.filters[t]={type:"equal",value:true,prop:t};break;case"checked":this.checked=false;this.setAttribute("state","unchecked");e.filters[t]={type:"equal",value:false,prop:t};break;case"unchecked":this.indeterminate=true;delete e.filters[t];this.setAttribute("state","none");break}a.stopPropagation();g.fn.applyFilter(e);return false}}};l.Browse=function(e,t,a,i){var r=y.getElementById(t),n={isotopeData:{},authorList:[],maxPlayTime:0,search:null,filters:{},isotope:null,container:r,mapPreviewPrefix:a};if(n.container){n.container.innerHTML="Downloading map data...";var s=new XMLHttpRequest;s.onreadystatechange=function(e){if(this.readyState===XMLHttpRequest.DONE){if(this.status>199&&this.status<300){try{n.container.innerHTML="Building page...";g.fn.buildBrowse(n,JSON.parse(this.responseText),i)}catch(e){n.container.innerHTML="An error has occured<br />Please drop by Discord to tell us how badly it affects your Factorio addiction.<br />100% no biters. 0% no bots.";l.console.error("Error parsing map data",e)}}else{n.container.innerHTML="Unable to fetch maps, please retry later.<br />Or stop by the Discord to see if there's an update in progress. 100% no worms. 0% no belts.";l.console.error("Error querying maps data",this)}}};s.open("GET",e,true);s.send(null)}else{l.console.error("No container")}}})(window,document,window.Isotope,window.noUiSlider,window.history);
